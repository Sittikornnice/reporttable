<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>รายงาน PA</title>

    <!-- Bootstrap CSS (ถ้ายังไม่มี) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Selectize CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/selectize@0.12.6/dist/css/selectize.default.css">

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Selectize JS -->
    <script src="https://cdn.jsdelivr.net/npm/selectize@0.12.6/dist/js/standalone/selectize.min.js"></script>
</head>
<body>
<div class="container mt-4">
    <h3>รายงานผลการประเมิน PA</h3>

    <form method="GET" action="{{ route('report_pa') }}">
        <div class="row">
            <!-- Dropdown ระดับ -->
            <div class="col-md-6 mb-3">
                <label for="unit_name" class="form-label">ระดับ:</label>
                <select name="unit_name" id="unit_name" class="form-select">
                    <option value="" {{ request('unit_name', $unit_name) == '' ? 'selected' : '' }}>เลือกระดับ...</option>
                    @foreach ($units->unique('unit_name')->where('unit_name', '!=', '') as $unit)
                        <option value="{{ $unit->unit_name }}" {{ request('unit_name', $unit_name) == $unit->unit_name ? 'selected' : '' }}>
                            {{ $unit->unit_name }}
                        </option>
                    @endforeach
                </select>
            </div>

            <!-- Dropdown หน่วยงาน -->
            <div class="col-md-6 mb-3">
                <label for="department" class="form-label">หน่วยงาน:</label>
                <select name="department" id="department" class="form-select">
                    <option value="" {{ request('department', $department) == '' ? 'selected' : '' }}>เลือกหน่วยงาน...</option>
                    @foreach ($units->unique('name_s')->where('name_s', '!=', '') as $unit)
                        <option value="{{ $unit->name_s }}" {{ request('department', $department) == $unit->name_s ? 'selected' : '' }}>
                            {{ $unit->name_s }}
                        </option>
                    @endforeach
                </select>
            </div>
        </div>

        <button type="submit" class="btn btn-primary">ค้นหา</button>
    </form>

    <!-- ส่วนแสดงผลลัพธ์ -->
    <div class="mt-4">
        <!-- คุณสามารถใส่ตารางผลลัพธ์หรือรายงานตรงนี้ -->
    </div>
</div>

<!-- Selectize Initializer -->
<script>
    $(document).ready(function () {
        $('#unit_name').selectize({
            placeholder: 'เลือกระดับ...',
            allowEmptyOption: true,
            create: false,
            sortField: 'text'
        });

        $('#department').selectize({
            placeholder: 'เลือกหน่วยงาน...',
            allowEmptyOption: true,
            create: false,
            sortField: 'text'
        });
    });
</script>
</body>
</html>



<div class="row">
    <!-- Dropdown ระดับ -->
    <div class="col-md-6">
        <label class="form-label">ระดับ:</label>
        <select id="unit_name" name="unit_name" placeholder="เลือกระดับ..."></select>
    </div>

    <!-- Dropdown หน่วยงาน -->
    <div class="col-md-6">
        <label class="form-label">หน่วยงาน:</label>
        <select id="department" name="department" placeholder="เลือกหน่วยงาน..."></select>
    </div>
</div>

<script>
    $(document).ready(function () {
        const units = @json($units);

        // เตรียมข้อมูล dropdown "ระดับ"
        const unitOptions = [];
        const unitOptgroups = new Set();

        units.forEach(u => {
            if (u.unit_name && u.name_s) {
                unitOptions.push({
                    group: u.name_s,
                    value: u.unit_name,
                    name: u.unit_name
                });
                unitOptgroups.add(u.name_s);
            }
        });

        // เตรียมข้อมูล dropdown "หน่วยงาน"
        const departmentOptions = [];
        const departmentOptgroups = new Set();

        units.forEach(u => {
            if (u.name_s && u.unit_name) {
                departmentOptions.push({
                    group: u.unit_name,
                    value: u.name_s,
                    name: u.name_s
                });
                departmentOptgroups.add(u.unit_name);
            }
        });

        // Selectize: ระดับ
        const unitSelect = $('#unit_name').selectize({
            options: unitOptions,
            optgroups: Array.from(unitOptgroups).map(g => ({
                value: g,
                label: "หน่วยงาน: " + g
            })),
            optgroupField: 'group',
            labelField: 'name',
            searchField: ['name'],
            sortField: 'name',
            placeholder: 'เลือกระดับ...'
        })[0].selectize;

        // Selectize: หน่วยงาน
        const deptSelect = $('#department').selectize({
            options: departmentOptions,
            optgroups: Array.from(departmentOptgroups).map(g => ({
                value: g,
                label: "ระดับ: " + g
            })),
            optgroupField: 'group',
            labelField: 'name',
            searchField: ['name'],
            sortField: 'name',
            placeholder: 'เลือกหน่วยงาน...'
        })[0].selectize;

        // กำหนดค่าที่เลือกไว้ก่อนหน้า
        const selectedUnit = "{{ request('unit_name', $unit_name) }}";
        const selectedDept = "{{ request('department', $department) }}";

        if (selectedUnit) {
            unitSelect.setValue(selectedUnit);
        }

        if (selectedDept) {
            deptSelect.setValue(selectedDept);
        }
    });
</script>




<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/2.2.2/js/dataTables.min.js"></script>

<script>
    $(document).ready(function () {
        $('#myTable').DataTable({
            language: {
                decimal: "",
                emptyTable: "ไม่มีข้อมูลในตาราง",
                info: "แสดง _START_ ถึง _END_ จาก _TOTAL_ รายการ",
                infoEmpty: "แสดง 0 ถึง 0 จาก 0 รายการ",
                infoFiltered: "(กรองจากทั้งหมด _MAX_ รายการ)",
                lengthMenu: "แสดง _MENU_ รายการ",
                loadingRecords: "กำลังโหลด...",
                processing: "กำลังประมวลผล...",
                search: "ค้นหา:",
                zeroRecords: "ไม่พบข้อมูลที่ค้นหา",
                paginate: {
                    first: "หน้าแรก",
                    last: "หน้าสุดท้าย",
                    next: "ถัดไป",
                    previous: "ก่อนหน้า"
                }
            },
            pageLength: 10,
            lengthMenu: [ [10, 25, 50, -1], [10, 25, 50, "ทั้งหมด"] ],
            responsive: true,
            order: [] // ❗ ไม่เรียงข้อมูลโดยอัตโนมัติตอนโหลด
        });
    });
</script>
